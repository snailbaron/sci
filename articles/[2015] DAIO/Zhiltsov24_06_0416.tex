
\section{Введение}

\sloppy{ В ~\cite{zhil1,zhil2} исследовались вопросы, связанные с кодированием сообщений, являющихся словами стохастического контекстно-свободного языка (стохастического КС-языка), при условии, что матрица первых моментов грамматики неразложима, и ее максимальный по модулю собственный корень $r$ (перронов корень) строго меньше единицы (докритический случай). При неразложимой матрице первых моментов нетерминальные символы грамматики образуют один класс.
%В ~\cite{bor} 

В настоящей работе рассматриваются стохастические КС-грамматики с произвольным числом классов нетерминальных символов, для которых исследуются свойства деревьев вывода фиксированной высоты $t$ при  $t\rightarrow \infty$ и $r<1.$ 
Найдено математическое ожидание числа вершин дерева вывода на ярусе $\tau$, к которым применено произвольное правило грамматики, при $\tau,$ $t-\tau \rightarrow \infty.$ Показано, что величина математического ожидания ограничена сверху константой.
Установлено, что в выводах слов большой длины происходит перераспределение частот применения правил по сравнению с частотами, определяемыми исходными вероятностями правил. При $t\rightarrow \infty$ правило, порождающее больше нетерминальных символов при своем применении, используется чаще в выводов слов; этим, по-видимому, обеспечивается достижение большой высоты дерева вывода. 
Показано, что математическое ожидание  числа применений произвольного правила грамматики во всем дереве вывода линейно зависит от высоты $t$ дерева. 

Полученные результаты показывают определяющую роль нетерминальных символов, принадлежащих классам, матрицы первых моменты для которых имеют перронов корень, совпадающий с $r.$

\section{Основные определения и предварительные сведения}

Для изложения результатов о контекстно-свободных языках будем
использовать определения КС-языка и стохастического КС-языка из ~\cite{aho,fu}.

Стохастической КС-грамматикой называется система
$G=\langle V_T,V_N,R,s \rangle,$ где $V_T$ и $V_N$ - конечные множества
терминальных и нетерминальных символов
(терминалов и нетерминалов) соответственно;
$s \in V_N$ - аксиома, $R$ -- множество правил.
Множество $R$ можно представить в виде
$R=\cup_{i=1}^k R_i$, где $k$ - мощность алфавита
$V_N$ и $R_i=\{r_{i1},\ldots, r_{i,n_i} \}.$
Каждое правило $r_{ij}$ из $R_i$ имеет вид
$$
r_{ij}:A_i\stackrel{p_{ij}}{\rightarrow }\beta _{ij},\,\,j=1,...,n_i,
$$
где $A_i\in V_N,\beta _{ij}\in (V_T\cup V_N)^{*}$ и $p_{ij}$ - вероятность
применения правила $r_{ij}$, удовлетворяющая следующим условиям:
$$
0<p_{ij}\leq 1 \,  \,\mbox {и}\,\, \sum_{j=1}^{n_i} p_{ij}=1.
$$
			
				
Для слов $\alpha $ и $\beta$
из $(V_T\cup V_N)^{*}$ будем применять запись $\alpha \Rightarrow \beta $, если
$\alpha=\alpha_1 A_i \alpha_2,$ $\beta =\alpha_1 \beta_{ij}\alpha_2$
для некоторых $\alpha_1,\alpha_2 \in ~(V_T\cup V_N)^{*},$
и в грамматике $G$ имеется правило $A_i\stackrel{p_{ij}}{\rightarrow }\beta
_{ij}.$

Обозначим через $\Rightarrow_{*}$ рефлексивное транзитивное замыкание
отношения $\Rightarrow$.
КС-язык, порождаемый грамматикой $G,$ определяется как множество слов $L_G=~\{
\alpha : s \Rightarrow_{*} \alpha, \alpha \in V_T^* \}.$ В работе рассматриваются бесконечные языки.

Каждому слову $\alpha$ КС-языка соответствует последовательность правил
грамматики (вывод), с помощью которой $\alpha$ выводится из аксиомы $s.$
Вероятность вывода определяется как произведение вероятностей правил,
образующих вывод. Вероятность слова $\alpha$ определяется как
сумма вероятностей всех различных левых выводов слова $\alpha$
(при левом выводе очередное правило применяется к самому левому нетерминалу
в слове).

Грамматика $G$ называется согласованной, если
%%
$$
\lim _{N\rightarrow \infty }\sum_{\alpha \in L, |\alpha |\le N}
p(\alpha)=1
$$
(здесь $|x|$ - длина слова $x$).
В работе рассматриваются согласованные KC-грамматики.

Левому выводу соответствует дерево вывода, которое строится следующим образом.
Корень дерева помечается аксиомой $s.$ Пусть при выводе слова
$\alpha$ на очередном шаге применяется
правило $A_i \stackrel{p_{ij}}{\rightarrow } b_{i_1} b_{i_2}\ldots
b_{i_m},$ где $b_{i_l} \in {V_N \cup V_T}$ $\,(l=1,\ldots,m).$
Тогда из самой левой вершины-листа дерева, помеченной символом
$A_i$ (при обходе листьев дерева слева направо), проводится $m$
дуг в вершины следующего яруса, которые помечаются слева направо
символами $b_{i_1}, b_{i_2},\ldots, b_{i_m}$ соответственно. Если правило грамматики имеет вид $A_i \stackrel{p_{ij}}{\rightarrow } \lambda,$ где $\lambda - $ пустое слово, в следующий ярус проводится одна дуга, и новая вершина помечается $\lambda.$
  
Слово $\alpha \in L_G$ получается при обходе кроны его дерева слева направо.
Высотой дерева называется максимальная длина пути от корня к листу. Вероятность дерева вывода определяется как вероятность соответствующего ему левого вывода.

Ярусы дерева будем нумеровать следующим образом.
Корень дерева расположен в нулевом ярусе. Вершины дерева,
смежные с корнем, образуют первый ярус, и т.д.
Дуги, выходящие из вершин $j-$го яруса, ведут к вершинам $(j+1)-$го яруса.

Рассмотрим многомерные производящие функции $
F_i( s_1,s_2,\ldots ,s_k) ,\,\,i=1,\ldots ,k,$
где переменная $s_i$ соответствует нетерминальному символу $A_i$.
Функция $F_i( s_1,s_2,\ldots ,s_k) $ строится по множеству правил $R_i$ с
одинаковой левой частью $A_i$ следующим образом.

Для каждого правила $A_i\stackrel{p_{ij}}{\rightarrow }\beta_{ij}$
выписывается слагаемое
$$
q_{ij=}p_{ij}\cdot s_1^{l_1}\cdot s_2^{l_2}\cdot \ldots \cdot s_k^{l_k},
$$
где $l_m$ - число вхождений нетерминала $A_m$ в $\beta_{ij}$ $(m=1, \ldots ,k).$
Тогда
$$
F_i( s_1,s_2,\ldots ,s_k) =\sum_{j=1}^{n_i}q_{ij}.
$$

Положим
$$
a^{i}_{j}=\frac{\partial F_i( s_1,\ldots ,s_k) }{\partial s_j}\mid
_{s_1=s_2=\ldots =s_k=1.}
$$

Квадратная матрица $A$ порядка $k,$ образованная элементами $a^{i}_{j},$
называется {\it матрицей первых моментов} грамматики $G.$

Так как матрица $A$ неотрицательна, существует максимальный по модулю
действительный неотрицательный собственный корень (перронов корень) \cite{gant}.
Обозначим его через $r$.

Известно необходимое и достаточное условие согласованности стохастической
КС-грамматики \cite{fu}:
стохастическая КС-грамматика при отсутствии бесполезных нетерминалов
(т.е. не участвующих в порождении слов языка) является согласованной тогда
и только тогда, когда $r\leq 1.$

В работе рассматривается докритический случай  $r < 1.$
Основные результаты относятся к стохастическим
КС-грамматикам с разложимой матрицей \cite{gant} первых моментов.

Введем некоторые обозначения.
Будем применять запись $A_i \rightarrow A_j$, если в грамматике существует правило вида $A_i\stackrel{p_{il}}{\rightarrow}\alpha_1 A_j \alpha_2$, где $\alpha_1,\alpha_2 \in (V_T \cup V_N)^*.$
Рефлексивное транзитивное замыкание отношения $\rightarrow$ обозначим $\rightarrow _*.$

Грамматика называется неразложимой, если для любых двух различных нетерминалов $A_i$ и $A_j$ верно
$A_i \rightarrow_* A_j.$ В противном случае она называется разложимой. Классом нетерминалов назовем максимальное по включению подмножество $K \in V_N,$ такое, что $A_i \rightarrow_* A_j$ для любых $A_i, A_j \in K.$

Для различных классов $K_1$ и $K_2$ будем писать $K_1 \prec K_2$), если
существуют $A_1 \in K_1$ и $A_2 \in K_2$, такие, что $A_1 \rightarrow A_2.$
Рефлексивное транзитивное замыкание отношения $\prec$ обозначим через $\prec _*$ и назовем отношением следования.

Очевидно, множество классов нетерминалов является разбиением множества $V_N,$ и отношение $\prec_*$ устанавливает на множестве классов нетерминалов частичный порядок.

Будем полагать, что классы нетерминалов перенумерованы числами от $1$ до $m$ таким образом, что из $K_i \prec K_j$ и $i\neq j$ следует $i < j.$

Соответствующая разложимой грамматике разложимая матрица \cite{gant} первых моментов $A$ имеет следующий вид:
\begin{equation}
A=\left(
\begin{array}{ccccc}
A_{11} & A_{12} & \ldots & A_{1 m-1} & A_{1m} \\
0 &    A_{22}   & \ldots & A_{2 m-1} & A_{2m} \\
\ldots & \ldots & \ldots & \ldots& \ldots \\
0 & 0 &  \ldots & A_{m-1 m-1} & A_{m-1 m} \\
0 & 0 &  \ldots & 0 & A_{m m} \\
\end{array}
\right).
\label{z1}
\end{equation}

Один класс нетерминалов в $A$ представлен множеством подряд идущих строк и соответствующим множеством столбцов с теми же номерами.
Для класса $K_i$ квадратная подматрица, образованная соответствующими строками и столбцами, обозначается $A_{ii}$.
Блоки, расположенные ниже главной диагонали, нулевые в силу упорядоченности классов нетерминалов. Подматрица $A_{ij}$ является нулевой, если $K_i \nprec K_j.$

Будем считать, что в грамматике нет особых классов, т.е. классов, состоящих из одного нетерминала, для которых $A_{ii}=0.$ Этого всегда можно добиться, применяя метод укрупнения правил грамматики, 
описанный в \cite{zhil1}.  

Для каждого класса $K_i$ матрица $A_{ii}$ неразложима.
Обозначим через $r_i$ перронов корень матрицы $A_{ii}.$ Для неразложимой матрицы перронов корень является положительным и простым по теореме Фробениуса \cite{gant}.  Очевидно, $r=\max_{i} \{r_i\},$ и $r>0.$

Пусть $J=\{i_1,i_2, \ldots , i_l\}$ --- множество всех номеров $i_j$ классов, для которых $r_{i_j}=r.$
%%Назовем $J$ определяющим множеством.

Зафиксируем пару $(l, h), $ $l,h \in \{1,2,\ldots,m\},$ и рассмотрим всевозможные последовательности классов $K_{i_1} \prec K_{i_2} \prec \ldots \prec K_{i_s},$ где $i_1=l, i_s=h.$ Среди всех таких последовательностей выберем ту, которая содержит наибольшее число классов с номерами из $J$. Это число обозначим через $s_{l h}.$ В случае $K_l \nprec_* K_h$ положим $s_{l h}=0.$

%Множество последовательностей $\Pi_1,$ содержащих $q_1$ классов с номерами из $J,$ обозначим через ${\cal M}.$ Последовательности из ${\cal M}$ будем называть максимальными путями. Множество классов с номерами из $J,$ принадлежащих максимальным путям, обозначим через $J({\cal M}).$


%Положим $q_l=s_{1l}.$
Дополнительно переупорядочим классы по неубыванию величины $s_{1l},$ причем при одинаковых значениях $s_{1l}$ сначала поставим классы с номерами из множества $J.$

%Разобьем полученную последовательность классов $K_1,K_2, \ldots,K_m$ на группы классов ${\cal M}_1,{\cal M}_2, \ldots, {\cal M}_w,$ при этом класс $K_l$ отнесем к группе ${\cal M}_1$ при $s_{1l} \le 1$, и к группе ${\cal M}_j$ при $s_{1l} = j$ $(j>1).$
%Заметим, что каждая группа содержит хотя бы один класс с номером из определяющего множества $J.$

%Для краткости далее будем называть группу классов просто группой.
%Для пары групп ${\cal M}_i$ и ${\cal M}_j$ определим $s_{ij}^*$ как $\max_{K_l \in {\cal M}_i,K_h \in {\cal M}_j}\{s_{lh}\}$.
%Положим $s_{11}^*=1.$

Среди последовательностей вида
%$$
\begin{equation}
K_{i_1} \prec K_{i_2} \prec \ldots \prec K_{i_s},
%$$
\label {z2}
%{2a}
\end{equation}
где $i_1=l$ и $i_s$ принмает всевозможные значения, выберем последовательности с наибольшим числом классов с номерами из $J$. Это число обозначим через $q_l.$

Максимальным путем назовем последовательность вида (\ref{z2}) при $i_1=1,$ содержащую $q_1$ классов с номерами из $J.$
Множество всех классов с номерами из $J$, принадлежащих максимальным путям, обозначим $J_{MAX}.$

Запись $A_{lh}^{(t)}$ будем применять для обозначения соответствующей подматрицы  матрицы $A^t.$

\medskip

\textbf{Теорема 1} \cite{zhil3}.
{\label{zhilteo1}
{\em При $t\rightarrow \infty:$ 
$$
a)\,\,A_{ij}^{(t)}=H_{ij} \cdot t^{s_{ij}-1} r^t (1+o(1)) \,\,\mbox {при} \,\, s_{ij}>0,  
$$
где $H_{ij}$ -- неотрицательная матрица, не зависящая от $t,$
$$
b)\,\, A_{ij}^{(t)}=o(r^t)\,\, \mbox {при} \,\, s_{ij}=0. 
$$

}
Подробное описание строения матрицы первых моментов приведено в \cite{zhil3}. 

\medskip

Пусть $G=\langle V_T,V_N,R,s\rangle$ - стохастическая КС-грамматика, где $V_N=\{A_1,A_2,\ldots,A_k \}.$ 
Будем полагать $s=A_1.$ 
%Пусть $A_i$ - некоторый нетерминальный символ грамматики $G$. 
Через $L_l$ обозначим язык, порожденный грамматикой $G_l,$ которая получается из $G$ заменой аксиомы на нетерминал $A_l.$ Будем считать, что $L=L_1$ для исходного языка $L.$
Обозначим через $D_l$ множество деревьев вывода слов из $L_l$ и через $Q_l(t)$ - вероятность множества деревьев вывода из $D_l$, высота которых больше $t.$
Эту вероятность назовем вероятностью продолжения по аналогии с теорией ветвящихся процессов.

Пусть $\left(A_{j+1},A_{j+2},\ldots,A_{j+k_i}\right)$ - последовательность нетерминалов, образующих класс $K_i,$ где $k_i$ -- число нетерминалов в $K_i,$ и $j+1$ -- номер первого по порядку нетерминала в $K_i.$

Через $Q^{(i)}(t)$ обо\-зна\-чим век\-тор вероятностей про\-дол\-же\-ния $Q^{(i)}(t)~=~\left(Q_{j+1}(t),Q_{j+2}(t), \ldots,Q_{j+k_i}(t)\right)^{T}.$

\medskip

\textbf{Теорема 2 \cite{zhil4}.}
{\em
При $t \rightarrow \infty$
$$
Q^{(i)}(t)=U^{(i)} \cdot t^{q_i-1}\cdot r^t \cdot (1+o(1)),
$$ 
где $U^{(i)}$ - некоторый положительный вектор. 
}

\medskip

Отметим, что в случае $r_i =r$ вектор $U^{(i)}$ пропорционален правому собственному вектору матрицы $A_{ii}$, соответствующему $r.$ Подробное описание свойств $Q^{(i)}(t)$ содержится в \cite{zhil4}.
\medskip

Обозначим $D_l^t$ множество всех деревьев вывода высоты $t$ для слов из $L_l=L(G_l).$ Вероятность множества $D_l^t$ обозначим через $P_l(t).$ Очевидно, $P_l(t)=Q_l(t-1)-Q_l(t).$

Из теоремы 2 вытекает
\medskip

\textbf{Следствие \cite{zhil4}.}
{\em
Пусть нетерминал $A_l \in K_i.$ Тогда
\begin{equation}
%$$
P_l(t)=u_l \cdot t^{q_i-1}r^{t-1}\cdot (1-r)\cdot (1+o(1)),
%$$
\label{Z3}
\end{equation}
где $u_l$ -- компонента вектора $U^{(i)},$ соответствующая нетерминалу $A_l.$}

\medskip
\section{Моменты}
\medskip

{\sloppy
Пусть $\Xi=(\xi_1,\ldots,\xi_k) -$ случайный вектор,
$\alpha^*=(\alpha_1, \ldots,\alpha_k )$ --- фиксированный вектор
с целочисленными неотрицательными компонентами и
$\alpha=\alpha_1+\ldots+\alpha_k.$ Обозначим
$$
\Xi^{[\alpha^*]}=\xi_1^{[\alpha_1]} \ldots \xi_n^{[\alpha_k]},
$$
где $x^{[a]}=x(x-1)\ldots (x-a+1).$
Математическое ожидание $M\Xi^{[\alpha^*]}$ будем называть $\alpha^*$-{\em моментом\/} $\Xi$ \cite{sev} и $\alpha$ - порядком момента.

Пусть $x^i_j(t) $  --- число нетерминалов $A_j$ в дереве вывода из
$D_i$ на ярусе $t.$ Через $M^i_{\alpha^*}(t)$ обозначим
$\alpha^*-$момент вектора
$X^i(t)=(x^i_1(t),\ldots,x^i_k(t)).$

Примем специальные обозначения для моментов первых
трех порядков.
Факториальные моменты первого порядка будем обозначать через $a^i_j(t).$
Для факториальных моментов второго порядка введем обозначения
$b^i_{jn}(t).$ Таким образом, $b^i_{jj}(t)=Mx^i_j(t)(x^i_j(t)-1)$ и
$b^i_{jn}(t)=Mx^i_j(t)x^i_n(t)$ при $j\neq n.$
Для факториальных моментов третьего порядка введем обозначения
$c^i_{jnq}(t)$.

Нетрудно заметить, что $a^i_j(1)$ -- элементы матрицы первых моментов,
для которых мы ввели ранее обозначения $a^i_j.$
Будем также применять далее обозначения
$b^i_{jn}$ для $b^i_{jn}(1).$

Свойства первых моментов исследованы в \cite{zhil3}, так как $a^i_j(t)$ - элемент матрицы $A^t$. 
Для вторых моментов известна следующая формула из \cite{sev}:
%$$
\begin{equation}
b^i_{jn}(t)=
\sum_{\tau=1}^t \sum_{l,m,s}a^i_l(t-\tau) b^l_{ms}
a^m_j(\tau-1) a^s_n(\tau-1).
%$$
\label{Z4}
\end{equation}
Пусть $a^i_l$ принадлежит подматрице $A_{h_i h_l},$ $a^m_j$ --- подматрице $A_{h_m h_j},$ и $a^s_n$ --- подматрице $A_{h_s h_n}.$
Подставим в (\ref{Z4}) представление для первых моментов из теоремы 1:
$$
b^i_{jn}(t)=\sum_{\tau=1}^t \sum_{l,m,s} d_{il} \cdot \left(\left(t-\tau\right)^{\delta_1}\cdot  r^{t-\tau}+o\left(\left(t-\tau\right)^{\delta_1}\cdot r^{t-\tau}\right)\right)\cdot b^l_{ms} \cdot d_{mj}\times
$$
$$
\left(\left( \tau-1\right)^{\delta_2}r^{\tau-1}+o\left(\left(\tau-1\right)^{\delta_2}\cdot r^{\tau-1}\right)\right) \cdot
d_{sn}\cdot\left(\left(\tau-1\right)^{\delta_3}\cdot r^{\tau-1}+
o\left(\left(\tau-1\right)^{\delta_3}\cdot r^{\tau-1}\right)\right).
$$
Здесь $\delta_1=s_{h_i h_l}-1,$ $\delta_2=s_{h_m h_j}-1,$ и $\delta_3=s_{h_s h_n}-1,$ и $d_{il},$ $d_{mj}$ и  $d_{sn}$ ---
коэффициенты в соответствующих элементах матрицы $A^t.$


Проведя несложные преобразования в полученном равенстве, найдем:
$$
b^i_{jn}(t)= r^t \cdot 
\sum_{l}   d_{il}\,t^{\delta_1} \cdot \left(\sum_{m,s} b^l_{ms}d_{mj} d_{sn}\right)\times
$$
$$
\sum_{\tau=1}^t\left(\left(1-\frac{\tau}{t} \right)^{\delta_1}+o \left(\left(1-\frac{\tau}{t} \right)^{\delta_1}\right)\right)
\cdot \left(\left(\tau-1\right)^{\delta_2+\delta_3}r^{\tau-2} \cdot \left( 1+o \left(1\right) \right)\right)
$$
Ряд
$\sum_{\tau=1}^{\infty} \left(\tau-1\right)^{\delta_2+\delta_3}  r^{\tau-2}$ сходится, поэтому величина 
$$
d_{il}\, \left(\sum_{m,s} b^l_{ms}d_{mj} d_{sn}\right)\cdot
\sum_{\tau=1}^t\left(\left(1-\frac{\tau}{t} \right)^{\delta_1}+o \left(\left(1-\frac{\tau}{t} \right)^{\delta_1}\right)\right)
\cdot \left(\left(\tau-1\right)^{\delta_2+\delta_3}r^{\tau-2} \cdot \left( 1+o \left(1\right) \right)\right)
$$
ограничена сверху.  Обозначим ее значение через $g^i_{jn}(l).$
Отметим, что $g^i_{jn}(l)>0$ в тех случаях, когда существуют $m$ и $s$ такие, что $b^l_{ms}>0,$
$$
K_{h_i}\prec_*K_{h_l}\prec_*K_{h_m}\prec_*K_{h_j} \, \, \, \mbox{и} \, \, \, K_{h_i}\prec_*K_{h_l}\prec_*K_{h_s}\prec_*K_{h_n}.
$$
Условие $b^l_{ms}>0$ выполняется тогда и только тогда, когда в грамматике существует правило с нетерминалом $A_l$ в левой части, содержащее в правой части оба нетерминала $A_m$ и $A_s.$

При $t\rightarrow \infty$
$$
b^i_{jn}(t)=\sum_{l} g^i_{jn}(l) \cdot t^{\delta_1} r^t (1+o(1)),
$$
где суммирование ведется по тем $l,$ для которых $g^i_{jn}(l)>0$.

Очевидно, определяющими в этой сумме являются слагаемые с теми значениями $l,$ для которых ${\delta_1}$ имеет наибольшее значение. Обозначим его через $\delta^i_{jn}.$ Поэтому формулу для $b^i_{jn}(t)$ можно записать в следующем виде:
%$$
\begin{equation}
b^i_{jn}(t)= g^i_{jn} t^{\delta^i_{jn}} r^t  \cdot (1+o(1)).
\label{Z5}
\end{equation}
%$$
Здесь $g^i_{jn}=\sum_{l} g^i_{jn}(l),$ где суммирование ведется по значениям $l,$ удовлетворяющим перечисленным выше условиям.
Так как $l\leq j$ и $l \le n,$ то $\delta^i_{jn} \leq \max \{s_{h_ih_j}~-~1,s_{h_ih_n}~-~1\}.$ Поэтому $b^i_{jn}(t) \le O\left(~ a^i_j(t)~+~a^i_n(t)~\right).$

Используя результаты из \cite{sev}, запишем формулу для третьего момента:
$$
c^i_{jnq}(t)=\sum_{\tau=1}^t \sum_l a^i_l(t-\tau)\cdot z^l_{jnq}(\tau-1).
$$
В этой формуле $z^l_{jnq}(\tau-1)$ состоит из конечного числа
слагаемых двух типов. Слагаемые первого типа имеют вид: $C
a^s_q(\tau~-~1) \cdot a^m_n(\tau~-~1) \cdot a^l_j(\tau~-~1) $ для некоторых
$s,m,l,$ где $C$ --- некоторая константа, зависящая от слагаемого;
слагаемые второго типа имеют вид: $C
a^l_j(\tau-1) \cdot b^m_{nq}(\tau-1)$ для некоторых $l,m$ и константы
$C.$

Поэтому вычисление $c^i_{jnq}(t)$ сводится к вычислению конечного числа
сумм вида
$
S_1(t)= \sum_{\tau=1}^t a^i_l(t-\tau)\cdot a^l_j(\tau-1)\cdot a^s_q(\tau-1)
\cdot a^m_n(\tau-1)
$
и вида
$
S_2(t)= \sum_{\tau=1}^t a^i_l(t-\tau)\cdot a^s_j(\tau-1)\cdot b^m_{nq}(\tau-1)
$
для некоторых значений $l,m,s.$

Оценим $S_1(t)$  и $S_2(t)$, используя оценки
$a^i_j(t)=O(t^{s_{ij}-1} r^t ),\,$ $b^i_{jl}(t) \le O\left(a^i_j(t)+a^i_l(t)\right).$ Применяя очевидное неравенство $s_{ij} \le w,$ где $w=\max_{i,j} \{ s_{ij} \}$, получим, что $S_1(t)~\leq~O(t^{w-1}r^t)$ и $S_2(t)\leq~O(t^{w-1}r^t)$.
Поэтому
$
c^i_{jnq}(t)\leq O\left(t^{w-1}r^t \right).
$


\medskip

\section{Закономерности в деревьях вывода слов стохастического КС-языка
}

\vspace*{3mm}

\medskip

Для доказательства основного результата раздела предварительно докажем две леммы.

Через $R_X(n)$ обозначим выражение
\begin{equation}
\prod_{j=1}^k \left(1-Q_j(n)\right)^{x_j}-
\prod_{j=1}^k \left(1-Q_j(n-1)\right)^{x_j},
\label{z6}
\end{equation}
где $X=(x_1, \ldots, x_k)$ --- целочисленный неотрицательный вектор, $Q_j(n)$ --- вероятности продолжения ($j=1,\ldots,k$), $k$ --- общее число нетерминалов в грамматике.


\medskip

\textbf{Лемма 1}.
{\em
При $n \rightarrow \infty$
\begin{equation}
\left(1-\sum_{j=1}^k x_j Q_j(n-1)\right) \cdot \sum_{j=1}^k \left(x_j \cdot \frac {P_j(n)}{1-Q_j(n-1)} \right)\le R_X(n) \le
\sum_{j=1}^k \left(x_j \cdot \frac{P_j(n)}{1-Q_j(n)}\right).
\label{z7}
\end{equation}
\/}

\medskip

{\bf Доказательство.}

В $R_X(n)$ вынесем за скобки $\prod_{j=1}^k \left(1-Q_j(n-1)\right)^{x_j}:$ 

%%$$
\begin{equation}
R_X(n)=\prod_{j=1}^k \left(1-Q_j(n-1)\right)^{x_j} \cdot  \left( \prod_{j=1}^k \left(\frac{1-Q_j(n)}{1-Q_j(n-1)} \right)^{x_j}-1\right).
\label{z8}
\end{equation}

%$$
Заметим, что $\frac{1-Q_j(n)}{1-Q_j(n-1)}=1+\frac {P_j(n)}{1-Q_j(n-1)}.$

К выражению $\left(1+\frac {P_j(n)}{1-Q_j(n-1)}\right)^{x_j}$ применим формулу бинома Ньютона и ограничимся первыми двумя слагаемыми. Получим неравенство $\left(1+\frac {P_j(n)}{1-Q_j(n-1)}\right)^{x_j} \geq 1+ x_j \cdot \frac {P_j(n)}{1-Q_j(n-1)}.$ Применяя это неравенство к (\ref{z8}), получим нижнюю оценку для $R_X(n):$
$$
R_X(n)\geq 
\prod_{j=1}^k \left(1 -Q_j(n-1)\right)^{x_j} \cdot \left( \sum_{j=1}^k x_j \cdot \frac {P_j(n)}{1-Q_j(n-1)} \right).
$$
Для оценки $\prod_{j=1}^k \left(1 -Q_j(n-1)\right)^{x_j}$ используем следующее равенство, доказанное в \cite{sev}:
\begin{equation}
(1-y_1)^{n_1} \ldots (1-y_k)^{n_k}=
1- \Delta, \,\,
\mbox{где} \,\, 0 \le \Delta \le \sum_{j}n_j y_j, \, \, \mbox{и} \,\, \, 0\leq y_j\leq 1.
\label{z9}
\end{equation}

Положив $Q_j(n-1)$ в качестве $y_j$ и $x_j$ в качестве $n_j,$ получим неравенство
 $\prod_{j=1}^k \left(1 -Q_j(n-1)\right)^{x_j} \geq 1-\sum_{j=1}^k x_j \cdot Q_j(n-1).$
Используя его, получаем, что
$$
R_X(n)\geq 
\left(1-\sum_{j=1}^k x_j Q_j(n-1)\right) \cdot \sum_{j=1}^k \left(x_j \cdot \frac {P_j(n)}{1-Q_j(n-1)} \right).
$$

Найдем теперь верхнюю оценку для $R_X(n).$
Аналогично (\ref{z8}) можно записать, что
\begin{equation}
R_X(n)=\prod_{j=1}^k \left(1-Q_j(n)\right)^{x_j} \cdot  \left(1- \prod_{j=1}^k \left(1-\frac {P_j(n)}{1-Q_j(n)}\right)^{x_j}\right).
\label{z10}
\end{equation}

Положив в (\ref{z9}) $\frac {P_j(n)}{1-Q_j(n)}$ в качестве $y_j$ и $x_j$ в качестве $n_j,$ получаем неравенство 
$$
 \prod_{j=1}^k \left(1-\frac {P_j(n)}{1-Q_j(n)}\right)^{x_j} \geq \left(1-\sum_{j=1}^k x_j \cdot \frac {P_j(n)}{1-Q_j(n)}\right).
$$
Используя эту оценку в (\ref{z10}), находим, что
$$
R_X(n)\le
\prod_{j=1}^k \left(1-Q_j(n) \right)^{x_j}\cdot
\sum_{j=1}^k \left(x_j \cdot \frac{P_j(n)}{1-Q_j(n)}\right)\le 
\sum_{j=1}^k \left(x_j \cdot \frac{P_j(n)}{1-Q_j(n)}\right).
$$

\medskip
Лемма доказана.

\medskip

Из леммы 1 как следствие вытекает 

\medskip

\textbf {Лемма 2.}
{\em
При $n \rightarrow \infty$
$$
R_X(n)=
\left(1+\psi_X(n)\right)
\sum_{j=1}^k x_j P_j(n),
$$
где $-c_1 n^{q_1-1}r^n \cdot \sum_{j=1}^k x_j  \le \psi_X(n)\le c_2 n^{q_1-1}r^n,$ и  $c_1$ и $c_2$ - некоторые положительные константы.
}

\medskip

{\bf Доказательство} леммы 2 получается применением к (\ref{z7}) оценок для $Q_j(n)$ и $P(D_l^{n}),$ следующих из теоремы 2 и следствия из нее. При этом используется неравенство $q_1\geq q_i,$ справедливое для любого $i.$  


%\nopagebreak
\medskip

%Пусть ${\cal L}$ --- язык, порожденный стохастической КС-грамматикой $G.$
Будем полагать, как и ранее, что аксиомой исходной грамматики $G$
является нетерминал $A_1.$
Рассмотрим $D^t_1$ --- множество деревьев из $D_1$ высоты $t.$
Для $d \in D_1^t$ через $p_t(d)$ будем обозначать условную вероятность дерева $d,$ т.е. $p_t(d)=\frac{p(d)}{P(D_1^t)}.$

\medskip

Через $M_i(t,\tau)$ обозначим условное математическое ожидание числа вершин
на ярусе $\tau$, помеченных нетерминалом $A_i,$ в деревьях вывода высоты $t.$

Для нетерминала $A_l \in K_j$ положим $q_l'=q_j$ и $s_{1l}'=s_{1j}.$

\medskip

\textbf {Теорема 3.}
{\em Пусть $G$ --- стохастическая КС-грамматика с разложимой
матрицей первых моментов, для которой $r<1.$ 

Тогда для любого $i \in \{1, \ldots, k\}$ при $\tau \rightarrow \infty $
и $t- \tau \rightarrow \infty $
выполняется асимптотическое равенство
\begin{equation}
M_i(t,\tau)\sim \frac{1}{t^{q_1-1}} \cdot \left(
f_i \cdot(t-\tau)^{q_i'-1} \cdot \tau^{s_{1i}'-1} +
\sum_{l =1}^k f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}\right),
%$$
\label{z11}
\end{equation}

в котором $f_{i},$ $f_{il}$ - неотрицательные константы и $\delta_{il}^1$ определено в $(\ref{Z5}).$
}
\medskip

\textbf {Доказательство.}
Представим $M_i(t,\tau)$ в виде
$$
M_i(t,\tau)=\sum_{d \in D^t_1} p_t(d) z_{i}(d,\tau)=\frac{P(D_1^t)}\sum_{d \in D^t_1} p(d) z_{i}(d,\tau),
$$
где $z_i (d,\tau)$ --  число вершин на ярусе $\tau$ дерева $d,$
помеченных нетерминалом $A_i.$

Рассмотрим неотрицательный целочисленный вектор $X=(x_1,\ldots,x_k),$
который будем называть далее вектором нетерминалов.
Используя вектор $X,$ мы можем записать, что
$$
M_i(t,\tau)= \frac{1}{P(D_1^t)}\sum_{X \ne 0} \Delta_X,
$$
где $\Delta_X$ -- вклад в математическое ожидание тех деревьев вывода
из $D^t_1$, которые на ярусе $\tau$ содержат $x_j$ вершин, помеченных
нетерминалом $A_j$ $(j=1,\ldots, k).$ Множество таких деревьев обозначим
через $D_X^t(\tau).$

Пусть $d \in D_X^t(\tau).$ Выделим в $d$ поддерево $d_0$ и последовательность
поддеревьев $(d_1,$ $d_2, \ldots d_n),$ где $n=\sum_{l=1}^k x_l.$
Поддерево $d_0$ получено из $d$ удалением всех вершин на ярусах
$\tau+1,$ $\tau+2, \ldots, t$ и инцидентных им дуг. Последовательность
$(d_1,$ $d_2, \ldots d_n)$ образуют все поддеревья, корни которых расположены
на ярусе $\tau$ дерева $d.$
При этом корни поддеревьев $d_1,$ $d_2, \ldots d_m$ расположены в дереве $d$
последовательно в порядке обхода вершин яруса $\tau$ слева направо, и каждое
дерево $d_l$ $(l=1,\ldots,n)$ содержит все дуги и вершины дерева $d,$
лежащие на путях от корня $d_l$ к листьям дерева $d.$

Выделим в $D_X^t(\tau)$ множество деревьев, имеющих в качестве поддерева
$d_0$ одно и то же дерево. Обозначим это множество через $D_0.$
Нетрудно понять, что
\begin{equation}
P\left(D_0\right)=
p(d_0)\cdot
\left(\prod_{l=1}^k (1-Q_l(t-\tau))^{x_l} -
\prod_{l=1}^k (1-Q_l(t-\tau-1))^{x_l}\right),
\label{z12}
\end{equation}
где $Q_l(n)$ --- суммарная вероятность деревьев из множества $D_l$,
высота которых больше $n,$ и, следовательно,
$\left(1-Q_l(n)\right)$ -- суммарная вероятность деревьев из
$D_l,$ высота которых не превосходит~$n.$

Обозначим через $\delta_1(X)$ выражение
$\prod_{l=1}^k (1-Q_l(t-\tau))^{x_l} $
и через $\delta_2(X)$ --- выражение
$ \prod_{l=1}^k (1-Q_l(t-\tau-1))^{x_l}.$

В (\ref{z11}) величина $p(d_0)\cdot\delta_1(X) $
есть суммарная вероятность деревьев, определяемых поддеревом $d_0,$
высота которых не превосходит $t,$ так как каждое поддерево с корнем
на ярусе $\tau$ имеет высоту, не превосходящую $(t-\tau).$

Вторая величина $p(d_0)\cdot\delta_2(X) $
есть суммарная вероятность деревьев, определяемых поддеревом $d_0,$
высота которых не превосходит $(t-\tau-1).$

Разность этих величин равна, очевидно, суммарной вероятности
деревьев высоты $t$, определяемых поддеревом $d_0,$ и значение
$\delta_1(X)-\delta_2(X)$ не зависит от порядка следования
вершин на ярусе $\tau,$ помеченных нетерминалами.

Выражение для $\delta_1(X)-\delta_2(X)$ в обозначениях леммы 1 есть $R_X(n)$ при $n=t-\tau.$  
 Поэтому
$$
P(D_X^t(\tau))=\sum_{d_0}\left( p(d_0)\cdot R_X(t-\tau)\right) =
R_X(t-\tau)\sum_{d_0}p(d_0),
$$
где суммирование ведется по всевозможным поддеревьям $d_0$
деревьев из $D_X^t(\tau).$

Через $D_X(\tau)$ обозначим множество всех деревьев вывода из $D_1,$ которым на ярусе $\tau$ соответствует вектор нетерминалов $X,$ и через $P_X(\tau)$ вероятность этого множества. Рассмотрим дерево из $D_X(\tau).$ Для каждой вершины этого дерева, помеченной некоторым нетерминалом $A_l,$ суммарная вероятность возможных деревьев с корнем в этой вершине
и листьями, помеченными только символами из $V_T\cup \{\lambda\}$, равна $P(D_l).$
Ввиду согласованности исходной грамматики $P(D_l)=1$ для любого $l$.
Поэтому 
$$
\sum_{d_0}p(d_0)=
\sum_{d_0}p(d_0) \cdot P(D_1)^{x_1} \cdot P(D_2)^{x_2}\cdot \ldots
\cdot P(D_k)^{x_k}=P_X\left(\tau \right).
$$
Таким образом,
$$
M_i(t,\tau)=\frac{1}{P(D^t_1)} \sum_{X \ne 0}\left( P_X(\tau)\cdot
R_X(t-\tau)\cdot x_{i}\right).
$$
Применяя лемму 2 для представления $R_X(t-\tau),$ получим:
$$
M_i(t,\tau)=\sum_{l=1}^k\frac{P(D_l^{t-\tau})}{P(D^t_1)}
\sum_{X \ne 0}\left( P_X(\tau)\cdot x_{i}\cdot
x_{l}\cdot\left(1+\psi_X(t-\tau)\right)\right).
$$

Введем обозначения
$S_1=
\sum_{X \ne 0}\left( P_X(\tau)\cdot x_{i}\cdot x_{l}\right) $
и
$S_2=
\sum_{X \ne 0}\left( P_X(\tau)\cdot x_{i}\cdot x_{l} \cdot \psi_X(t-\tau)\right).$

Используя первые и вторые моменты, мы можем записать, что
$S_1=b^1_{il}(\tau)$ при $i \ne l$ и
$S_1=b^1_{ii}(\tau)+a^1_i(\tau)$ при $l=i.$

Учитывая оценку из леммы 2 для $\psi_X(n)$ и оценки для
первых трех моментов, получим нижнюю и верхнюю
оценки для $S_2:$
$$
S_2 \ge
%$$
%$$
-c_2 \tau^{q_1-1} r^{\tau} \sum_{X \ne 0} \left(P_X(\tau)\cdot x_{i}\cdot x_{l} \cdot
\sum_j x_{j}\right)\ge
%$$
%$$
-c \cdot\tau^{2 q_1-2} r^{2 \tau},
$$
где $c$ --- некоторая положительная константа.

С другой стороны,
$$
S_2  \le c_1 \tau^{q_1-1} r^{\tau}
\sum_{X \ne 0} \left(P_X(\tau)\cdot x_{i}\cdot x_{l}\right)= c_1\tau^{q_1-1} r^{\tau}\cdot S_1.
$$
Учитывая выражение $S_1$ через моменты, окончательно получаем оценку  $S_2=O(\tau^{2q_1-2}r^{2\tau}).$
\medskip

Вернемся к вычислению $M_i(t,\tau):$
$$
M_i(t,\tau)=
%$$
%$$
\sum_{l\ne i} \frac{P(D_l^{t-\tau})}{P(D^t_1)}
b^1_{il}(\tau)+ \frac{P(D_i^{t-\tau})}{P(D^t_1)}
\left(b^1_{ii}(\tau)+a^1_i(\tau) \right)+
\sum_{l=1}^k\frac{P(D_l^{t-\tau})}{P(D^t_1)} \cdot O\left(\tau^{2q_1-2}r^{2\tau}\right).
$$

Раскрывая моменты и используя (\ref{Z3}), после
несложных преобразований получим:
$$
M_i(t,\tau)=
\frac{1}{u_1 \cdot (1-r)\cdot t^{q_1-1} \cdot r^{t-1} \cdot (1+\phi_1(t))} \times 
$$
$$
\times\left(\sum_{l=1}^{k} u_l \cdot(1-r)\cdot (t-\tau)^{q_l'-1} \cdot r^{t-\tau-1} \cdot (1+\phi_l(t-\tau))\right.
%$$
%$$
\times\left(g_{il}^1 \cdot r^{\tau}\cdot \tau^{\delta_{il}^1}  \left(1+\psi_{il}(\tau)\right)\right)+
$$
$$
 + u_i \cdot (1-r) \cdot (t-\tau)^{q_i'-1} r^{t-\tau-1}(1+\phi_i(t-\tau)) \cdot h^1_i\cdot
\tau^{s_{1i}'-1} r^{\tau}(1+\varphi_{1i}(\tau))+
$$
$$
\left. + O\left(\left(t-\tau\right)^{q_{l}-1} \tau^{2q_1-2}r^{t+\tau-1}\right)\right),
$$
где $\phi_i(n)=o(1),$ $\psi_{il}(n)=o(1),$ $\varphi_{1i}(n)=o(1),$ $q_l'=q_j$ для $A_l \in K_j,$ и $s_{1i}'=s_{1m}$ для  $A_i \in K_m.$

Отсюда следует, что
\begin{equation}
M_i(t,\tau)=
 \frac{1}{u_1\cdot t^{q_1-1}}\left(\sum_{l=1}^{k} u_l \cdot g_{il}^1 \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}+ \right.
\label{z13}
\end{equation}
$$
+\left.
 u_i \cdot h^{1}_{i}\cdot(t-\tau)^{q_i'-1} \cdot \tau^{s_{1i}'-1} \right) \left(1+\xi(\tau,t-\tau)\right),
$$
где $\xi(\tau,t-\tau) \rightarrow 0$ при $\tau,t-\tau\rightarrow \infty.$ 

Вводя обозначения $f_i=\frac{u_i h_{i}^1}{u_1},$ $f_{il}=\frac{u_i g_{il}^1}{u_1},$ получаем $(\ref{z11}).$
Теорема доказана.

\medskip

Рассмотрим подробнее слагаемые в (\ref{z13}).
Определяющими в сумме являются те значения $l,$ для которых $g_{il}^1>0$ и $q_l'~+~\delta_{il}^1~=~q_1.$ Равенство справедливо при одновременном выполнении следующих условий:

1) нетерминал $A_l$ принадлежит классу $K_{j_1}$ с $j_1\in J_{MAX},$

2) $A_i \in K_{j_2},$ для которого $K_{j_1} \prec_* K_{j_2}.$

Обозначим $N_i$ множество номеров $l,$ для которых выполняются условия 1) и 2).

Отметим, что слагаемое $f_i\cdot(t-\tau)^{q_i'-1} \cdot \tau^{s_{1i}'-1} $ влияет на значение $M_i(t,\tau)$ при
$s_{1i}'~+~q_i'~-~1~=~q_1.$ Это равенство выполняется в случае, если $A_i \in K_{j_2},$ где $j_2\in J_{MAX}.$
Поэтому равенство (\ref{z13}) при $N_i \ne \emptyset$ можно записать в виде
$$
M_i(t,\tau)= \frac{1}{t^{q_1-1} }
 \left(\sum_{l \in N_i} f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}+ f_i \cdot(t-\tau)^{q_i'-1} \cdot \tau^{s_{1i}'-1} \right) \left(1+\xi(\tau,t-\tau)\right).
$$

Очевидно, $M_i(t,\tau)\le O(1/t)$ при $N_i = \emptyset.$

\medskip

Пусть $r_{ij}$ --- произвольное правило грамматики $G.$
Через $v_l^{(ij)}$ обозначим число нетерминалов $A_l$
в правой части правила $r_{ij}.$
Условное математическое ожидание числа применений правила $r_{ij}$
в деревьях вывода высоты $t$ на ярусе $\tau$ будем обозначать через
$M_{ij}(t,\tau).$

\medskip

\textbf {Теорема 4.}
{\em Пусть $G$ --- стохастическая КС-грамматика с разложимой
матрицей первых моментов, для которой перронов корень $r<1$ , и $D^t_1$ -- множество деревьев вывода
высоты $t.$

Тогда при $\tau \rightarrow \infty $ и $t-\tau \rightarrow \infty $
выполняется следующее асимптотическое равенство:
$$
M_{ij}(t,\tau)\sim \frac{p_{ij}}{t^{q_1-1}} \left(\sum_{l =1}^k f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}+
\frac{1}{{r }} \sum_{m=1}^k f_m\cdot v_m^{(ij)}\cdot
 (t-\tau)^{q_m'-1}\tau^{s_{1i}'-1}\right).
$$
}
В формулировке теоремы $p_{ij}$ --- вероятность правила $r_{ij},$
а величины $q_l',$ $\delta_{il}^1,$ $f_{il}$ и $f_m$ имеют тот же смысл, что и в теореме 3.

\medskip

\textbf {Доказательство.} \nopagebreak
Обозначим $z_{ij}(d,\tau)$ число вершин на ярусе $\tau$ дерева $d,$
помеченных нетерминалом $A_i,$ к которым применено правило $r_{ij}.$
Используя неотрицательный целочисленный вектор $X=(x_1,\ldots,x_k),$ можно записать, что
$$
M_{ij}(t,\tau)= \sum_{X \ne 0}
\sum_{d \in D_X^t(\tau)} p_t(d) z_{ij}(d,\tau),
$$
где $D_X^t(\tau)$ введено в доказательстве теоремы 3.

Представим $z_{ij}(d,\tau)$ в виде суммы случайных величин
$I_1+I_2+ \ldots+I_{x_i},$
где $I_m=1,$ если к $m$-й по порядку вершине среди вершин,
помеченных нетерминалом $A_m$ на ярусе $\tau,$
применено правило $r_{ij},$ и $I_m=0$ в противном случае
$(m=1,2, \ldots, x_i).$
Тогда
$$
M_{ij}(t,\tau)= \sum_{X \ne 0}
\sum_{d \in D_X^t(\tau)} p_t(d)\cdot (I_1+I_2+\ldots +I_{x_i}).
$$
Очевидно, что случайные величины $I_m$ $(m=1,2, \ldots, x_i)$ --
одинаково распределены на $D_X^t(\tau),$ поэтому
$$
M_{ij}(t,\tau)=\frac{1}{P(D^t_1)}\sum_{X \ne 0}
P\left(D_{X,1}^t(\tau)\right) \cdot x_i,
$$
где $P(D_{X,1}^t(\tau))$ -- суммарная вероятность тех деревьев
из $D_X^t(\tau),$ в которых правило $r_{ij}$ применено к первой по порядку
вершине на ярусе $\tau,$ помеченной $A_i.$

Подсчитаем вероятность $P\left(D_{X,1}^t(\tau)\right):$
$$
P\left(D_{X,1}^t(\tau)\right)=p_{ij} \cdot
P_X(\tau) \times
%$$
%$$
\left[\prod_{m=1}^k \left(1-Q_m(t-\tau)\right)^{x_m^{\prime}}\cdot
\prod_{m=1}^k \left(1-Q_m(t-\tau-1)\right)^{s_m^{(ij)}}- \right.
$$
%$$
\begin{equation}
\left. \prod_{m=1}^k \left(1-Q_m(t-\tau-1)\right)^{x_m^{\prime}}\cdot
\prod_{m=1}^k \left(1-Q_m(t-\tau-2)\right)^{v_m^{(ij)}}\right].
%$$
\label{z14}
\end{equation}
Здесь $X^{\prime}=(x_1^{\prime},\ldots,x_k^{\prime})=
(x_1,\ldots,x_{i-1},x_i-1,x_{i+1},\ldots, x_k).$
Величина $P_X(\tau)$ имеет тот же смысл, что и в доказательстве теоремы 3.
Выражение в квадратных скобках в (\ref{z14})
аналогично выражению $R_X(t-\tau).$  При этом
с помощью множителей $\left(1-Q_m(t-\tau-1)\right)^{v_m^{(ij)}}$ и
$\left(1-Q_m(t-\tau-2)\right)^{v_m^{(ij)}}$
учитывается тот факт, что к первому нетерминалу $A_i$ на ярусе $\tau$
применено правило $r_{ij},$ которому на ярусе $\tau+1$ соответствует
$v_m^{(ij)}$ вершин, помеченных нетерминалом $A_m$ $(m=1, \ldots, k).$

Выражение  в (\ref{z14}) можно представить в виде
$$
P\left(D_{X,1}^t(\tau)\right)=p_{ij} \cdot P_X(\tau) \cdot
\frac{1}{1-Q_i(t-\tau)}\cdot \prod_{m=1}^k \left(1-Q_m(t-\tau-1)\right)
^{v_m^{(ij)}}\times
$$
$$
\left[\prod_{m=1}^k \left(1-Q_m(t-\tau)\right)^{x_m}-
\frac{1-Q_i(t-\tau)}{1-Q_i(t-\tau-1)}\times \right.
$$
$$
\left. \prod_{m=1}^k \left(\left(1-Q_m(t-\tau-1)\right)^{x_m} \cdot
\frac{\left(1-Q_m(t-\tau-2)\right)^{v_m^{(ij)}}}
{\left(1-Q_m(t-\tau-1)\right)^{v_m^{(ij)}}}\right)\right].
$$
Очевидно, 
$$
\frac{1-Q_i(t-\tau)}{1-Q_i(t-\tau-1)}=
1+\frac{P(D_i^{t-\tau})}{1-Q_i(t-\tau-1)}.
$$
Аналогично имеем:
$$
\frac{(1-Q_m(t-\tau-2))^{v_m^{(ij)}}}
{(1-Q_m(t-\tau-1))^{v_m^{(ij)}}}=
\left(1-\frac{P(D_m^{t-\tau-1})}
{1-Q_m(t-\tau-1)}\right)^{v_m^{(ij)}}.
$$
Применяя теорему 2 и следствие из нее для оценки $Q_i(t-\tau-1)$ и $P(D_i^{t-\tau}),$ а также учитывая, что 
$v_m^{(ij)}$ -- константа, определяемая правой частью правила $r_{ij},$ после несложных преобразований получим, что
$$
P\left(D^t_{X,1}(\tau)\right)=
%$$
%$$
p_{ij} \cdot P_X(\tau) \left[ R_X(t-\tau) +
%p_{ij} \cdot P_X(\tau)
 \prod_{m=1}^k \left(1-Q_m(t-\tau-1)\right)^{x_m} \times
\right.
$$
$$
\left.\left(\sum_{m=1}^k v_m^{(ij)}P(D_m^{t-\tau-1})-P(D_i^{t-\tau}) \right)\right]
\cdot
\left(1+O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\right)\right).
$$
(Здесь $R_X(t-\tau)$ -- величина, рассмотренная в лемме 1.)

Вернемся к вычислению $M_{ij}(t,\tau),$ учитывая оценку 
$$
\prod_{m=1}^k \left(1-Q_m(t-\tau-1)\right)^{x_m}=
1- O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\sum_{m=1}^k x_m\right),
$$
следующую из (\ref{z4}) и теоремы 2.
Тогда
$$
M_{ij}(t,\tau)=
\frac{1}{P(D_1^t)} \left[\sum_{X \ne 0} p_{ij} \cdot P_X(\tau) \cdot R_X(t-\tau)\cdot x_i+ \right.
\left(\sum_{m=1}^k v_m^{(ij)} P\left(D_m^{t-\tau-1}\right)-
P\left(D_i^{t-\tau}\right)\right)\times
$$
$$
\left.\sum_{X \ne 0} p_{ij} \cdot P_X(\tau) \cdot x_i
\cdot \left(1- O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\sum_{m=1}^k x_m\right)\right)\right]\cdot
\left(1+O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\right)\right).
$$
Величина
$$
\frac{1}{P(D_1^t)} \cdot
\sum_{X \ne 0} P_X(\tau) \cdot R_X(t-\tau)\cdot x_i
$$
есть $M_i(t,\tau)$ из теоремы 3, и
$$
\sum_{X \ne 0} P_X(\tau) \cdot x_i=
a_i^1(\tau)=h_i^1\cdot \tau^{s_{1i}'-1}r^{\tau}(1+o(1)),
$$
где $a_i^1 (\tau)$ -- элемент матрицы $A^{\tau},$
$A$ -- матрица первых моментов, и
%$c_{1i}$ и
$s_{1i}'$ имеет тот же смысл, что и в теореме 3.

Кроме того,
$$
\sum_{X \ne 0} P_X(\tau) \cdot x_i \cdot O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\sum_{m=1}^k x_m\right)=
$$
$$
O\left((t-\tau)^{q_1-1}\cdot r^{t-\tau}\right)\sum_{m=1}^k b^1_{im}(\tau)+a_i^1(\tau)=
O\left(\tau^{q_1-1} \cdot (t-\tau)^{q_1-1 }r^{t}\right),
$$
где $b^1_{im}(\tau)$ -- вторые моменты.
Следовательно,
$$
M_{ij}(t,\tau)= \left(M_i(t,\tau)\cdot p_{ij} +
\frac{p_{ij} \cdot h_{i}^1\cdot \tau^{s_{1i}'-1}r^{\tau}\cdot (1+o(1)) }{P(D_1^t)} \times \right.
$$
$$
\left. \left(\sum_{m=1}^k v_m^{(ij)}\cdot
P(D_m^{t-\tau-1})- P(D_i^{t-\tau}) \right)\right)
\cdot \left(1+ O\left((t-\tau)^{q_1-1} r^{t-\tau}\right)\right).
$$

Применяя теорему 3 к $M_i(t,\tau)$ и формулу (\ref{Z3}) к $P(D_m^{n}),$ после проведения несложных преобразований
$M_{ij}(t,\tau)$ можем представить в следующем виде:
$$
M_{ij}(t,\tau) =
$$
\begin{equation}
\frac{p_{ij}}{t^{q_1-1}} \left(\sum_{l =1}^k f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}+
\frac{1}{{r }} \sum_{m=1}^k f_m\cdot v_m^{(ij)}\cdot
 (t-\tau)^{q_m'-1}\tau^{s_{1i}'-1}\right)+ \xi_{ij}(t,\tau),
\label{z15}
\end{equation}
где $\xi_{ij}(t,\tau)\rightarrow 0$ при $\tau \rightarrow \infty,$ $t \rightarrow \infty.$
Теорема доказана.

\medskip

Сделаем несколько выводов из теоремы 4.

1. $M_{ij}(t,\tau)$ ограничено константой
при $\tau \rightarrow \infty,$ $t-\tau \rightarrow \infty.$

2. Величина $\sum_{m=1}^k f_m \cdot s_m^{(ij)}\cdot
 (t-\tau)^{q_m'-1}\tau^{s_{1i}'-1}$ имеет большее значение для тех правил, которые
содержат в правой части большее количество нетерминальных символов.

3. Величина $\sum_{l =1}^k f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}$ имеет одно и то же значение для всех правил грамматики с одинаковой левой частью $A_i.$

\medskip

Рассмотрим случайную величину $S_{ij}(t)$ --- число правил $r_{ij}$ в дереве вывода из $D_1^t$.
Эту величину можно представить в виде 
$S_{ij}(t)=q_{ij}(t,0)+q_{ij}(t,1)+\ldots +q_{ij}(t,t-1),$
где $q_{ij}(t,\tau)$ --- число правил $r_{ij}$ на ярусе $\tau$ в дереве
из $D_1^t$.

\medskip

{\textbf Теорема 5.}
{\em Пусть $G$ --- стохастическая КС-грамматика с разложимой
матрицей первых моментов, для которой $r<1.$ 

Тогда при $t \rightarrow \infty $ выполняется асимптотическое равенство
$$
M\left(S_{ij}(t)\right) \sim w_{ij}\cdot t,
$$
где $w_{ij}$ - константа, определяемая грамматикой $G.$}
\medskip

{\bf Доказательство.}

Разобьем $S_{ij}(t)$ на три части:
$$
S_{ij}(t)=S_{ij}^{(1)}(t)+S_{ij}^{(2)}(t)+S_{ij}^{(3)}(t),
$$
где
$$
S_{ij}^{(1)}(t)=q_{ij}(t,0)+\ldots+q_{ij}(t,\tau_0-1),
$$
$$
S_{ij}^{(2)}(t)=q_{ij}(t,\tau_0)+\ldots+q_{ij}(t,t-\tau_0-1),
$$
$$
S_{ij}^{(3)}(t)=q_{ij}(t,t-\tau_0)+\ldots+q_{ij}(t,t-1),
$$
и положим $\tau_0=\lfloor \log\log t \rfloor$ (здесь и далее логарифм
берется по основанию 2).
Число слагаемых в $S_{ij}^{(1)}(t)$ и в $S_{ij}^{(3)}(t)$ равно
$\lfloor \log\log t \rfloor,$ а в $S_{ij}^{(2)}(t)$ равно
$t-2 \lfloor \log\log t \rfloor.$

Найдем математические ожидания $M\left(S_{ij}^{(1)}(t)\right),$
$M\left(S_{ij}^{(2)}(t)\right)$ и
$M\left(S_{ij}^{(3)}(t)\right).$

Величину $M\left(S_{ij}^{(1)}(t)\right)$ можно представить в следующем виде:
$$
M\left(S_{ij}^{(1)}(t)\right)=M_{ij}(t,0)+M_{ij}(t,1)+\ldots +
M_{ij}(t,\tau_0-1).
$$

Оценим $q_{ij}(t,\tau)$ для $\tau < \tau_0.$
Обозначим через $k_{max}$ максимальное число нетерминалов в~правой части правил грамматики $G.$ Тогда
$q_{ij}(t,\tau)\leq k_{max}^{\tau}< k_{max}^{\tau_0}.$
Поэтому
$
M_{ij}(t,\tau)< k_{max}^{\tau_0}
$
и
$$
M\left(S_{ij}^{(1)}(t)\right)\leq k_{max}^{\tau_0}  \tau_0\leq
k_{max}^{\log \log t}
  \log \log t=\log^{c_1} t \,  \log \log t \leq \log^{c_2} t,
$$
где $c_1=\log k_{max},$ $\, c_2=c_1+1.$

Для $t-\tau_0 \leq \tau < t$ имеем:
$$
M_{ij}(t,\tau)\leq M_{i}(t,\tau) =
\frac 1 {P(D^t)} \sum_{X} P_X(\tau)   R_X(t-\tau)   x_i \leq
\frac{1}{P(D^t)} \sum_{X} P_X(\tau)   x_i=
$$
$$
\frac{1}{P(D^t)}  a^1_{i}(\tau)\le
O\left(\frac{\tau^{q_1-1}}{t^{q_1-1}\cdot r^{t-\tau}}\right)\le O\left(\frac 1{r^{t-\tau}}\right).
$$
Поэтому
$$
M\left(S_{ij}^{(3)}(t)\right) \leq
\sum_{t-\tau_0}^{t-1} O\left(\frac{1}{r^{t-\tau}}\right)
=O\left(\frac {\tau_0}{r^{\tau_0}}\right)
=O\left(\frac {\log \log t}{r^{\log \log t}}\right)=O\left(\log ^{c_3} t\right)
$$
для некоторой константы $c_3>0.$

Для $\tau,$ удовлетворяющего условию
$\tau_0 \leq \tau \leq t-\tau_0-1,$ применим теорему 4:
$$
M\left(S_{ij}^{(2)}(t)\right)=
\sum_{\tau=\lfloor \log\log t \rfloor}^{t-\lfloor \log\log t \rfloor-1}
\frac{p_{ij}}{t^{q_1-1}} \left(\sum_{l =1}^k f_{il} \cdot (t-\tau)^{q_l'-1}\cdot \tau^{\delta_{il}^1}+ \right.
$$
$$
\left. \frac{1}{{r }} \sum_{m=1}^k f_m\cdot s_m^{(ij)}\cdot
(t-\tau)^{q_m'-1}\tau^{s_{1i}'-1}\right)+
\sum_{\tau=\lfloor \log\log t \rfloor}^{t-\lfloor \log\log t \rfloor-1} \xi(t,\tau).
$$

Оценим величину
$
\delta=\frac{1}{t^{n_1+n_2}} \cdot\sum_{\tau=\lfloor \log\log t \rfloor}^{t-\lfloor \log\log t \rfloor-1}
(t-\tau)^{n_1}\cdot \tau^{n_2}:
$
$$
\delta= 
\sum_{\tau=\lfloor \log\log t \rfloor}^{t-\lfloor \log\log t \rfloor-1} \left(1-\frac{\tau}{t}\right)^{n_1} \left(\frac{\tau}{t}\right)^{n_2}=
$$
$$
\sum_{\tau=\lfloor \log\log t \rfloor}^{t-\lfloor \log\log t \rfloor-1}
\sum_{n=0}^{n_1} (-1)^{n} C_{n_1}^n \cdot \left( \frac{\tau}{t} \right)^{n+n_2} =
\left(\sum_{n=0}^{n_1} (-1)^{n} C_{n_1}^n \cdot \frac{t}{n+n_2+1}  \right)+o(t).
$$
Очевидно, величина $\sum_{n=0}^{n_1} (-1)^{n} C_{n_1}^n \cdot \frac{1}{n+n_2+1}$ является константой, зависящей от $n_1$ и $n_2,$ обозначим ее $\alpha(n_1,n_2)$.
Применяя обозначение $\alpha(n_1,n_2),$ мы можем записать:
$$
\delta=\alpha(n_1,n_2)\cdot t+o(t).
$$
Применим полученную оценку к вычислению $M\left(S_{ij}^{(2)}(t)\right),$ учитывая равенства
$q_l'~+~\delta_{il}^1~=~q_1$ и $q_i'+s'_{1i}-1=q_1:$
$$
M\left(S_{ij}^{(2)}(t)\right)=p_{ij}\cdot
\left[\sum_{l =1}^k f_{il} \cdot \alpha(q_l'-1,\delta_{il}^1)+
\frac{1}{{r }} \sum_{m=1}^k f_m\cdot s_m^{(ij)}\cdot
\alpha(q_m'-1,s_{1i}'-1)\right]\cdot t +o(t).
$$
Константу в квадратных скобках обозначим $w_{ij}.$
Используя полученные оценки для $M\left(S_{ij}^{(1)}(t)\right),$
$M\left(S_{ij}^{(2)}(t)\right)$ и
$M\left(S_{ij}^{(3)}(t)\right),$ находим, что при $t \rightarrow \infty$
$$
M\left(S_{ij}(t)\right)=w_{ij}\cdot t+o(t)+
O\left(\log^{c_2} t\right) +
O\left(\log ^{c_3} t\right)=w_{ij}\cdot t +o(t).
$$

Теорема доказана.

\medskip
}

\begin{thebibliography}{8}

\bibitem{aho}
\textbf{Ахо~А., Ульман~Дж.} Теория синтаксического анализа, перевода и
компиляции. Том 1. М: Мир, 1978.

%\bibitem{bor} Борисов А. Е. Кодирование слов стохастического КС-языка, порожденного разложимой грамматикой
%с двумя нетерминалами // Вестник Нижегородского университета им. Н.И. Лобачевского. Серия Математика, 2004. --- Выпуск %1(2). --- С.18 -- 28.
%
\bibitem{gant}
\textbf{Гантмахер~Ф.~Р.} Теория матриц. М: Наука, 1967.

\bibitem{zhil1}
\textbf{Жильцова~Л.~П.} Закономерности применения правил грамматики
в выводах слов стохастического контекстно-свободного языка~//
Математические вопросы кибернетики. 2000. Вып.~9. С.~101--126.

\bibitem{zhil2}
\textbf{Жильцова~Л.~П.} О нижней оценке стоимости кодирования и асимптотически
оптимальном кодировании стохастического контекстно-свободного языка~//
Дискретный анализ и исследование операций. 2001. Серия 1, Т.~8, \No~3. С.~26--45.

\bibitem{zhil3}
\textbf{Жильцова~Л.~П.} О матрице первых моментов разложимой стохастической
КС-грамматики~//
Ученые записки Казанского государственного университета. Физико-математические
науки. 2009. Т.~151, книга~2. С.~80--89.

\bibitem{zhil4}
\textbf{Жильцова~Л.~П.} О вероятностях продолжения деревьев вывода в разложимых
стохастических КС-грамматиках. Докритический случай~//
Вестник Нижегородского университета им. Н.И. Лобачевского. 2012. \No~4. С.~217--224.

\bibitem{sev}
\textbf{Севастьянов~В.~А.} Ветвящиеся процессы. М: Наука, 1971.

\bibitem{fu}
\textbf{Фу~К.} Структурные методы в распознавании образов. М: Мир, 1977.

\end{thebibliography}

}
}
\end{document}
